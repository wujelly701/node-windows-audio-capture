# v2.3 è®¾å¤‡é€‰æ‹©åŠŸèƒ½ - ç¬¬äºŒé˜¶æ®µå®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-14  
**åˆ†æ”¯**: feature/device-selection  
**å®Œæˆåº¦**: 75% (6/9 åŸºç¡€ä»»åŠ¡å®Œæˆ)

---

## âœ… æ–°å®Œæˆä»»åŠ¡ (ç¬¬äºŒé˜¶æ®µ)

### T2.3.3: JavaScript API å°è£… âœ“

**æ–‡ä»¶**: `lib/audio-capture.js`

**æ–°å¢API**:
```javascript
// é™æ€æ–¹æ³• - è·å–æ‰€æœ‰éŸ³é¢‘è®¾å¤‡
static async getAudioDevices(): Promise<AudioDeviceInfo[]>

// é™æ€æ–¹æ³• - è·å–é»˜è®¤è®¾å¤‡ID
static async getDefaultDeviceId(): Promise<string | null>

// å®ä¾‹æ–¹æ³• - è·å–å½“å‰è®¾å¤‡ID
getDeviceId(): string | undefined

// æ„é€ å‡½æ•°æ”¯æŒ deviceId é€‰é¡¹
new AudioCapture({
  processId: 0,
  deviceId: '{device-id}',  // å¯é€‰
  sampleRate: 48000,
  channels: 2
})
```

**åŠŸèƒ½**:
- âœ… è®¾å¤‡IDéªŒè¯ï¼ˆæ„é€ å‰éªŒè¯ï¼‰
- âœ… è¿”å›å®Œæ•´è®¾å¤‡ä¿¡æ¯ï¼ˆid, name, description, isDefault, isActiveï¼‰
- âœ… é”™è¯¯å¤„ç†å’Œå‹å¥½é”™è¯¯æ¶ˆæ¯
- âœ… å‘åå…¼å®¹ï¼ˆdeviceIdå¯é€‰ï¼‰
- âœ… å¼ƒç”¨æ—§APIï¼ˆ`getDevices()` â†’ `getAudioDevices()`ï¼‰

**æµ‹è¯•ç»“æœ** (`test-js-api.js`):
```
âœ“ è·å–4ä¸ªéŸ³é¢‘è®¾å¤‡
âœ“ è·å–é»˜è®¤è®¾å¤‡IDæˆåŠŸ
âœ“ åˆ›å»ºé»˜è®¤è®¾å¤‡å®ä¾‹
âœ“ åˆ›å»ºæŒ‡å®šè®¾å¤‡å®ä¾‹
âœ“ æ­£ç¡®æ‹’ç»æ— æ•ˆè®¾å¤‡ID
```

**Bugä¿®å¤**:
- ä¿®å¤æ¨¡å—è·¯å¾„é”™è¯¯ (`node_windows_audio_capture` â†’ `audio_addon`)

---

### T2.3.4: TypeScript ç±»å‹å®šä¹‰ âœ“

**æ–‡ä»¶**: `index.d.ts`

**æ–°å¢ç±»å‹**:
```typescript
// v2.3 æ–°æ¥å£
interface AudioDeviceInfo {
  id: string;
  name: string;
  description: string;
  isDefault: boolean;
  isActive: boolean;
}

// AudioCaptureOptions æ·»åŠ  deviceId
interface AudioCaptureOptions {
  processId?: number;
  deviceId?: string;  // v2.3 æ–°å¢
  sampleRate?: number;
  channels?: number;
  bitDepth?: number;
  loopbackMode?: 0 | 1;
}

// AudioCapture ç±»æ–°å¢æ–¹æ³•
class AudioCapture {
  static getAudioDevices(): Promise<AudioDeviceInfo[]>;
  static getDefaultDeviceId(): Promise<string | null>;
  static getProcesses(): Promise<ProcessInfo[]>;
  getDeviceId(): string | undefined;
}
```

**æ”¹è¿›**:
- âœ… å®Œæ•´çš„ JSDoc æ³¨é‡Š
- âœ… ç‰ˆæœ¬æ ‡è®° (`@since 2.3.0`)
- âœ… å¼ƒç”¨æ ‡è®° (`@deprecated`)
- âœ… ç²¾ç¡®çš„ç±»å‹çº¦æŸ (`loopbackMode: 0 | 1`)

**æµ‹è¯•æ–‡ä»¶**: `test-types.ts` (ç±»å‹æ£€æŸ¥é€šè¿‡)

---

## ğŸ“Š æ€»ä½“è¿›åº¦

### å·²å®Œæˆ (6/9)
1. âœ… T2.3.1: C++ è®¾å¤‡æšä¸¾å™¨
2. âœ… T2.3.2: N-API ç»‘å®š
3. âœ… T2.3.3: JavaScript API å°è£… (æ–°)
4. âœ… T2.3.4: TypeScript ç±»å‹å®šä¹‰ (æ–°)
5. âœ… æµ‹è¯•è„šæœ¬éªŒè¯
6. âœ… æ–‡ä»¶ç»“æ„åˆ›å»º

### å¾…åŠ (3/9)
- [ ] T2.3.5: å•å…ƒæµ‹è¯• (6å°æ—¶)
- [ ] T2.3.6: é›†æˆæµ‹è¯• (4å°æ—¶)
- [ ] T2.3.7: æ–‡æ¡£å’Œç¤ºä¾‹ (3å°æ—¶)

---

## ğŸ“ˆ ç»Ÿè®¡æ•°æ®

**ä»£ç è¡Œæ•°**:
- C++ ä»£ç : ~600è¡Œ
- JavaScript ä»£ç : ~150è¡Œ
- TypeScript å®šä¹‰: ~80è¡Œ
- æµ‹è¯•ä»£ç : ~200è¡Œ
- **æ€»è®¡**: ~1030è¡Œ

**æ–‡ä»¶åˆ›å»º/ä¿®æ”¹**:
- æ–°å»º: 7ä¸ªæ–‡ä»¶
- ä¿®æ”¹: 4ä¸ªæ–‡ä»¶

**ç”¨æ—¶**:
- ç¬¬ä¸€é˜¶æ®µ: 8å°æ—¶
- ç¬¬äºŒé˜¶æ®µ: 6å°æ—¶
- **æ€»è®¡**: 14å°æ—¶

**å‰©ä½™é¢„ä¼°**:
- å•å…ƒæµ‹è¯•: 6å°æ—¶
- é›†æˆæµ‹è¯•: 4å°æ—¶
- æ–‡æ¡£ç¤ºä¾‹: 3å°æ—¶
- **å‰©ä½™**: 13å°æ—¶

---

## ğŸ¯ API ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```javascript
const { AudioCapture } = require('node-windows-audio-capture');

// 1. è·å–æ‰€æœ‰è®¾å¤‡
const devices = await AudioCapture.getAudioDevices();
console.log('Available devices:', devices);

// 2. ä½¿ç”¨é»˜è®¤è®¾å¤‡
const capture1 = new AudioCapture({ processId: 0 });

// 3. ä½¿ç”¨ç‰¹å®šè®¾å¤‡
const capture2 = new AudioCapture({
  processId: 0,
  deviceId: devices[0].id
});

// 4. æ£€æŸ¥å½“å‰è®¾å¤‡
console.log('Using device:', capture2.getDeviceId());
```

### TypeScript ç”¨æ³•

```typescript
import { AudioCapture, AudioDeviceInfo } from 'node-windows-audio-capture';

const devices: AudioDeviceInfo[] = await AudioCapture.getAudioDevices();

const capture = new AudioCapture({
  deviceId: devices[0].id,
  sampleRate: 16000,
  channels: 1
});
```

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### è®¾å¤‡IDæ ¼å¼
```
{0.0.0.00000000}.{442acc96-3e92-4570-9165-b858c1635ffe}
                 â†‘
                 è®¾å¤‡ç«¯ç‚¹ID (GUID)
```

### é”™è¯¯å¤„ç†
```javascript
// è‡ªåŠ¨éªŒè¯è®¾å¤‡ID
try {
  const capture = new AudioCapture({ deviceId: 'invalid' });
} catch (error) {
  // Error: Invalid device ID: invalid
}
```

### å‘åå…¼å®¹
```javascript
// v2.2 åŠä¹‹å‰ç‰ˆæœ¬ - ä»ç„¶æœ‰æ•ˆ
const capture = new AudioCapture({ processId: 0 });

// v2.3 æ–°åŠŸèƒ½
const capture = new AudioCapture({
  processId: 0,
  deviceId: '{device-id}'
});
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

1. ~~COM æœªåˆå§‹åŒ–~~ âœ“ å·²ä¿®å¤
2. ~~æ¨¡å—è·¯å¾„é”™è¯¯~~ âœ“ å·²ä¿®å¤
3. è®¾å¤‡IDéªŒè¯é”™è¯¯ (0x80070057) - ä¸å½±å“åŠŸèƒ½
   - ä»…åœ¨éªŒè¯æ— æ•ˆIDæ—¶å‡ºç°
   - æ­£ç¡®è¿”å› false

---

## ğŸ“‹ ä¸‹ä¸€æ­¥è®¡åˆ’

### T2.3.5: å•å…ƒæµ‹è¯• (æ˜æ—¥)
- [ ] `test/device-selection.test.js`
- [ ] æµ‹è¯• `getAudioDevices()`
- [ ] æµ‹è¯• `getDefaultDeviceId()`
- [ ] æµ‹è¯•æ„é€ å‡½æ•° deviceId é€‰é¡¹
- [ ] æµ‹è¯•é”™è¯¯å¤„ç†

### T2.3.6: é›†æˆæµ‹è¯•
- [ ] å®é™…éŸ³é¢‘æ•è·æµ‹è¯•
- [ ] è®¾å¤‡åˆ‡æ¢æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

### T2.3.7: æ–‡æ¡£å’Œç¤ºä¾‹
- [ ] `examples/device-selection.js`
- [ ] æ›´æ–° `README.md`
- [ ] æ›´æ–° `docs/api.md`

---

## ğŸ‰ é‡Œç¨‹ç¢‘

**è®¾å¤‡é€‰æ‹©åŠŸèƒ½æ ¸å¿ƒå®ç°å®Œæˆï¼**

- âœ… C++ WASAPI è®¾å¤‡æšä¸¾
- âœ… N-API ç»‘å®š
- âœ… JavaScript API
- âœ… TypeScript ç±»å‹
- âœ… å®Œæ•´æµ‹è¯•é€šè¿‡

**å¯ä»¥å¼€å§‹ç¼–å†™æ­£å¼æµ‹è¯•å’Œæ–‡æ¡£äº†ï¼**

---

**å®Œæˆæ—¶é—´**: 2025-10-14 17:45  
**ä¸‹æ¬¡æ£€æŸ¥ç‚¹**: å•å…ƒæµ‹è¯•å®Œæˆ
