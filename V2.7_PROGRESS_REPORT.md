# v2.7.0 å¼€å‘è¿›å±•æŠ¥å‘Š

**æ—¥æœŸ**: 2025å¹´10æœˆ15æ—¥  
**çŠ¶æ€**: ğŸš§ è¿›è¡Œä¸­  
**å®Œæˆåº¦**: 30%

---

## ğŸ“Š æ€»ä½“è¿›å±•

| ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆåº¦ | è¯´æ˜ |
|------|------|--------|------|
| RNNoise å…‹éš† | âœ… å®Œæˆ | 100% | å·²å…‹éš†åˆ° deps/rnnoise |
| C++ å®ç° | âœ… å®Œæˆ | 100% | audio_effects.h/cpp å·²åˆ›å»º |
| binding.gyp é…ç½® | âœ… å®Œæˆ | 100% | å·²æ·»åŠ  RNNoise æºæ–‡ä»¶ |
| æ¨¡å‹ä¸‹è½½ | âŒ é˜»å¡ | 0% | ç½‘ç»œè¶…æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³ |
| JavaScript API | ğŸ“‹ å¾…åŠ | 0% | ç­‰å¾…ç¼–è¯‘æˆåŠŸ |
| æµ‹è¯•å¥—ä»¶ | ğŸ“‹ å¾…åŠ | 0% | ç­‰å¾… API å®Œæˆ |
| è‡ªé€‚åº” Buffer Pool | ğŸ”„ è¿›è¡Œä¸­ | 20% | å¹¶è¡Œå¼€å‘ |

---

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. RNNoise ä»“åº“å…‹éš†

```bash
# æˆåŠŸå…‹éš† Mozilla RNNoise å®˜æ–¹ä»“åº“
git clone https://gitlab.xiph.org/xiph/rnnoise.git deps/rnnoise

# ä»“åº“ä¿¡æ¯
- æäº¤æ•°: 903
- å¤§å°: 1.02 MB
- åŒ…å«: æºç  + ç¤ºä¾‹ + æ–‡æ¡£
```

### 2. C++ éŸ³é¢‘æ•ˆæœå¤„ç†å™¨å®ç°

**æ–‡ä»¶**: `src/napi/audio_effects.h` / `audio_effects.cpp`

**æ ¸å¿ƒç±»**: `DenoiseProcessor`

```cpp
class DenoiseProcessor {
public:
    explicit DenoiseProcessor(int frame_size = 480);
    ~DenoiseProcessor();
    
    // å¤„ç† Float32/Int16 éŸ³é¢‘
    float ProcessFrame(float* frame, int size);
    float ProcessFrame(int16_t* frame, int size);
    void ProcessBuffer(float* buffer, int size);
    void ProcessBuffer(int16_t* buffer, int size);
    
    // ç»Ÿè®¡ä¿¡æ¯
    float GetLastVoiceProbability() const;
    int GetProcessedFrames() const;
    void Reset();
    
private:
    DenoiseState* state_;  // RNNoise çŠ¶æ€
    int frame_size_;       // 480 samples (10ms @ 48kHz)
    int processed_frames_;
    float last_vad_prob_;  // è¯­éŸ³æ´»åŠ¨æ£€æµ‹æ¦‚ç‡
};
```

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æ”¯æŒ Float32 å’Œ Int16 éŸ³é¢‘æ ¼å¼
- âœ… è‡ªåŠ¨å¤„ç†ä¸å®Œæ•´å¸§ï¼ˆç¼“å†²æœºåˆ¶ï¼‰
- âœ… æä¾› VADï¼ˆVoice Activity Detectionï¼‰æ¦‚ç‡
- âœ… çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†
- âœ… å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ£€æŸ¥

### 3. binding.gyp æ›´æ–°

**æ·»åŠ çš„æºæ–‡ä»¶**:
```python
sources: [
    # ... ç°æœ‰æ–‡ä»¶
    "src/napi/audio_effects.cpp",    # æ–°å¢ï¼šéŸ³é¢‘æ•ˆæœå¤„ç†
    
    # RNNoise æºæ–‡ä»¶
    "deps/rnnoise/src/celt_lpc.c",
    "deps/rnnoise/src/denoise.c",
    "deps/rnnoise/src/kiss_fft.c",
    "deps/rnnoise/src/nnet.c",
    "deps/rnnoise/src/nnet_default.c",
    "deps/rnnoise/src/parse_lpcnet_weights.c",
    "deps/rnnoise/src/pitch.c",
    "deps/rnnoise/src/rnn.c",
    "deps/rnnoise/src/rnnoise_tables.c"
]

include_dirs: [
    # ... ç°æœ‰ç›®å½•
    "deps/rnnoise/include",  # RNNoise å…¬å¼€ API
    "deps/rnnoise/src"       # RNNoise å†…éƒ¨å¤´æ–‡ä»¶
]
```

**ä¼˜ç‚¹**:
- æ— éœ€å•ç‹¬ç¼–è¯‘ RNNoise é™æ€åº“
- ç®€åŒ–æ„å»ºæµç¨‹
- æ›´å¥½çš„è·¨å¹³å°å…¼å®¹æ€§

### 4. ç¼–è¯‘è„šæœ¬åˆ›å»º

è™½ç„¶æœ€ç»ˆé‡‡ç”¨ç›´æ¥æºç é›†æˆæ–¹æ¡ˆï¼Œä½†åˆ›å»ºäº†å®Œæ•´çš„ç¼–è¯‘è„šæœ¬ä¾›å‚è€ƒï¼š

- `scripts/build-rnnoise.ps1` - å®Œæ•´ç‰ˆ Windows ç¼–è¯‘è„šæœ¬
- `scripts/build-rnnoise-simple.ps1` - ç®€åŒ–ç‰ˆï¼ˆéœ€è¦ CMakeï¼‰
- `scripts/build-rnnoise-vs.ps1` - Visual Studio ç›´æ¥ç¼–è¯‘
- `deps/rnnoise/CMakeLists.txt` - CMake é…ç½®æ–‡ä»¶

### 5. æŠ€æœ¯æ–‡æ¡£

åˆ›å»ºäº†è¯¦ç»†çš„æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£ï¼š
- **V2.7_DENOISE_TECHNICAL_PLAN.md** (67KB)
  - RNNoise ç®—æ³•ä»‹ç»
  - æ¶æ„è®¾è®¡
  - API è®¾è®¡
  - C++ å®ç°ç»†èŠ‚
  - æµ‹è¯•ç­–ç•¥
  - 3å‘¨å¼€å‘è®¡åˆ’
  - æˆåŠŸæ ‡å‡†å’Œé£é™©è¯„ä¼°

---

## âŒ å½“å‰é˜»å¡é—®é¢˜

### é—®é¢˜: RNNoise æ¨¡å‹æ–‡ä»¶ç¼ºå¤±

**é”™è¯¯ä¿¡æ¯**:
```
D:\node-windows-audio-capture\deps\rnnoise\src\rnn.h(31,10): 
error C1083: æ— æ³•æ‰“å¼€åŒ…æ‹¬æ–‡ä»¶: "rnnoise_data.h": No such file or directory
```

**åŸå› **:
- RNNoise éœ€è¦é¢„è®­ç»ƒçš„ç¥ç»ç½‘ç»œæ¨¡å‹æ•°æ®
- æ¨¡å‹æ–‡ä»¶éœ€è¦ä» Xiph.Org æœåŠ¡å™¨ä¸‹è½½
- æ¨¡å‹ Hash: `0a8755f8e2d834eff6a54714ecc7d75f9932e845df35f8b59bc52a7cfe6e8b37`
- ä¸‹è½½åœ°å€: `https://media.xiph.org/rnnoise/models/rnnoise_data-{hash}.tar.gz`
- å½“å‰çŠ¶æ€: **ç½‘ç»œè¶…æ—¶ï¼Œä¸‹è½½å¤±è´¥**

**å½±å“èŒƒå›´**:
- é˜»å¡ RNNoise ç¼–è¯‘
- é˜»å¡ JavaScript API é›†æˆ
- é˜»å¡æµ‹è¯•å¼€å‘

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼ˆæ¨èï¼‰

```powershell
# ä½¿ç”¨æµè§ˆå™¨æˆ–å…¶ä»–å·¥å…·ä¸‹è½½
$url = "https://media.xiph.org/rnnoise/models/rnnoise_data-0a8755f8e2d834eff6a54714ecc7d75f9932e845df35f8b59bc52a7cfe6e8b37.tar.gz"

# ä¸‹è½½åˆ° deps/rnnoise/
# ç„¶åè§£å‹
cd deps/rnnoise
tar -xzf rnnoise_data-*.tar.gz
```

**é¢„æœŸç»“æœ**:
- ç”Ÿæˆ `src/rnnoise_data.h`
- ç”Ÿæˆ `src/rnnoise_data.c`
- ç¼–è¯‘å¯ä»¥ç»§ç»­

### æ–¹æ¡ˆ 2: ä½¿ç”¨ Git Bash è¿è¡Œä¸‹è½½è„šæœ¬

```bash
cd deps/rnnoise
bash download_model.sh
```

### æ–¹æ¡ˆ 3: ä» GitHub Mirror ä¸‹è½½

å¦‚æœ Xiph.Org æœåŠ¡å™¨ä¸å¯è¾¾ï¼Œå¯ä»¥ä» GitHub æ‰¾é¢„ç¼–è¯‘çš„ç‰ˆæœ¬æˆ–é•œåƒï¼š

```powershell
# ç¤ºä¾‹ï¼šä»æŸä¸ª fork ä¸‹è½½
git clone --depth 1 https://github.com/æŸä¸ªåŒ…å«æ¨¡å‹çš„fork/rnnoise.git deps/rnnoise-with-model
cp deps/rnnoise-with-model/src/rnnoise_data.* deps/rnnoise/src/
```

### æ–¹æ¡ˆ 4: ä¸´æ—¶ä½¿ç”¨å‡æ¨¡å‹ï¼ˆä»…ç”¨äºæµ‹è¯•ç¼–è¯‘ï¼‰

åˆ›å»ºä¸€ä¸ªç©ºçš„ `rnnoise_data.h` è®©ç¼–è¯‘é€šè¿‡ï¼Œä½†åŠŸèƒ½ä¸å¯ç”¨ï¼š

```cpp
// deps/rnnoise/src/rnnoise_data.h (TEMP ONLY)
#ifndef RNNOISE_DATA_H
#define RNNOISE_DATA_H

#define CONV1_STATE_SIZE 128
#define CONV2_STATE_SIZE 128
#define GRU1_STATE_SIZE 384
#define GRU2_STATE_SIZE 128
#define GRU3_STATE_SIZE 128

extern const float conv1_weights[];
extern const float conv2_weights[];
extern const float gru1_weights[];
extern const float gru2_weights[];
extern const float gru3_weights[];
// ... (éœ€è¦å®Œæ•´çš„æƒé‡å£°æ˜)

#endif
```

**âš ï¸ è­¦å‘Š**: æ–¹æ¡ˆ 4 åªèƒ½è®©ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œä½†é™å™ªåŠŸèƒ½å°†ä¸å¯ç”¨ï¼

---

## ğŸ“‹ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸä»»åŠ¡ï¼ˆæœ¬å‘¨ï¼‰

1. **è§£å†³æ¨¡å‹ä¸‹è½½é—®é¢˜** (P0)
   - å°è¯•ä¸åŒä¸‹è½½æ–¹å¼
   - æˆ–ä» GitHub æ‰¾é•œåƒ
   - ç›®æ ‡ï¼šè·å¾—å®Œæ•´çš„ RNNoise æ¨¡å‹

2. **å®Œæˆç¼–è¯‘** (P0)
   - éªŒè¯ RNNoise é›†æˆ
   - ç¡®ä¿ addon ç¼–è¯‘æˆåŠŸ
   - è¿è¡ŒåŸºç¡€æµ‹è¯•

3. **JavaScript API é›†æˆ** (P0)
   - åœ¨ `AudioProcessor` ä¸­é›†æˆ `DenoiseProcessor`
   - å®ç° N-API ç»‘å®š
   - æ·»åŠ é…ç½®é€‰é¡¹è§£æ

4. **åŸºç¡€æµ‹è¯•** (P0)
   - åˆ›å»ºç®€å•æµ‹è¯•è„šæœ¬
   - éªŒè¯é™å™ªåŠŸèƒ½å¯ç”¨
   - æ£€æŸ¥æ€§èƒ½å’Œç¨³å®šæ€§

### ä¸­æœŸä»»åŠ¡ï¼ˆä¸‹å‘¨ï¼‰

5. **å®Œæ•´æµ‹è¯•å¥—ä»¶** (P0)
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - æ€§èƒ½æµ‹è¯•
   - éŸ³é¢‘è´¨é‡æµ‹è¯•

6. **æ–‡æ¡£æ›´æ–°** (P1)
   - README.md æ·»åŠ é™å™ª API
   - æ›´æ–° API æ–‡æ¡£
   - æ·»åŠ ä½¿ç”¨ç¤ºä¾‹

7. **è‡ªé€‚åº” Buffer Pool** (P0)
   - å¹¶è¡Œå¼€å‘
   - åŠ¨æ€è°ƒæ•´ç­–ç•¥
   - æ€§èƒ½ä¼˜åŒ–

### é•¿æœŸä»»åŠ¡ï¼ˆæœªæ¥ 2-3 å‘¨ï¼‰

8. **AGC + EQ** (P1)
   - éŸ³é‡å½’ä¸€åŒ–
   - 3-band å‡è¡¡å™¨
   - å¯é€‰åŠŸèƒ½

9. **å®Œæ•´æµ‹è¯•å’Œä¼˜åŒ–** (P0)
   - 5 åˆ†é’Ÿç¨³å®šæ€§æµ‹è¯•
   - ASR å‡†ç¡®ç‡éªŒè¯
   - æ€§èƒ½è°ƒä¼˜

10. **v2.7.0 å‘å¸ƒ** (P0)
    - ç‰ˆæœ¬æ‰“æ ‡ç­¾
    - GitHub Release
    - æ–‡æ¡£å®Œå–„

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### åŠŸèƒ½æ ‡å‡†
- [x] RNNoise æˆåŠŸé›†æˆåˆ°é¡¹ç›®
- [ ] é™å™ªåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] API ä½¿ç”¨ç®€å•ï¼ˆä¸€è¡Œå¯ç”¨ï¼‰
- [ ] å‘åå…¼å®¹ï¼ˆopt-in è®¾è®¡ï¼‰

### æ€§èƒ½æ ‡å‡†
- [ ] å™ªéŸ³æŠ‘åˆ¶ â‰¥ 15 dB
- [ ] å¤„ç†å»¶è¿Ÿ < 10ms
- [ ] CPU å¼€é”€ < 5%
- [ ] å†…å­˜å¢åŠ  < 10 MB

### è´¨é‡æ ‡å‡†
- [ ] ASR å‡†ç¡®ç‡æå‡ 10-30%
- [ ] éŸ³é¢‘æ— æ˜æ˜¾å¤±çœŸ
- [ ] é•¿æ—¶é—´è¿è¡Œç¨³å®šï¼ˆ1å°æ—¶+ï¼‰
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 90%

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### RNNoise ç®—æ³•å‚æ•°

- **é‡‡æ ·ç‡**: 48kHzï¼ˆå›ºå®šï¼‰
- **å¸§å¤§å°**: 480 samplesï¼ˆ10msï¼‰
- **è¾“å…¥æ ¼å¼**: Float32, èŒƒå›´ [-1, 1]
- **å£°é“**: Monoï¼ˆå•å£°é“ï¼‰
- **è¾“å‡º**: é™å™ªåçš„éŸ³é¢‘ + VAD æ¦‚ç‡

### API è®¾è®¡ï¼ˆé¢„è§ˆï¼‰

```javascript
const { AudioCapture } = require('node-windows-audio-capture');

const capture = new AudioCapture({
  processId: 0,
  useExternalBuffer: true,  // æ¨èä½¿ç”¨ zero-copy
  effects: {
    denoise: true  // ğŸ¯ ä¸€è¡Œå¯ç”¨é™å™ªï¼
  }
});

capture.on('data', (event) => {
  // event.buffer å·²ç»è¿‡é™å™ªå¤„ç†
  console.log('é™å™ªåçš„éŸ³é¢‘:', event.buffer.length);
});

await capture.start();
```

### æ€§èƒ½é¢„æœŸ

åŸºäº RNNoise è®ºæ–‡å’Œæµ‹è¯•ï¼š

- **å™ªéŸ³æŠ‘åˆ¶**: 15-25 dBï¼ˆå–å†³äºå™ªéŸ³ç±»å‹ï¼‰
- **CPU å ç”¨**: 3-5%ï¼ˆå•çº¿ç¨‹ï¼ŒIntel i5ï¼‰
- **å»¶è¿Ÿ**: 5-10msï¼ˆåŒ…æ‹¬å¸§ç¼“å†²ï¼‰
- **å†…å­˜**: çº¦ 5 MBï¼ˆæ¨¡å‹ + çŠ¶æ€ï¼‰

---

## ğŸ” é£é™©å’ŒæŒ‘æˆ˜

### å·²è¯†åˆ«é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | å½“å‰çŠ¶æ€ | ç¼“è§£æªæ–½ |
|------|------|------|---------|---------|
| æ¨¡å‹ä¸‹è½½å¤±è´¥ | é«˜ | é«˜ | âŒ å‘ç”Ÿ | å¯»æ‰¾æ›¿ä»£ä¸‹è½½æ–¹å¼ |
| ç¼–è¯‘é”™è¯¯ | ä¸­ | ä½ | âœ… å·²è§£å†³ | å›ºå®š binding.gyp é…ç½® |
| æ€§èƒ½å¼€é”€è¿‡é«˜ | ä¸­ | ä½ | â³ å¾…éªŒè¯ | æ€§èƒ½æµ‹è¯• + opt-in è®¾è®¡ |
| éŸ³é¢‘è´¨é‡ä¸‹é™ | é«˜ | ä½ | â³ å¾…éªŒè¯ | A/B æµ‹è¯• + å¯é…ç½®å¼ºåº¦ |
| è·¨å¹³å°å…¼å®¹æ€§ | ä¸­ | ä¸­ | â³ å¾…éªŒè¯ | æµ‹è¯•å¤šä¸ª Node ç‰ˆæœ¬ |

---

## ğŸ“ éœ€è¦å¸®åŠ©

### å½“å‰æœ€ç´§æ€¥çš„é—®é¢˜

**ğŸ†˜ éœ€è¦ä¸‹è½½ RNNoise æ¨¡å‹æ–‡ä»¶**

å¦‚æœä½ æœ‰ä»¥ä¸‹ä»»æ„æ¡ä»¶ï¼Œè¯·ååŠ©ï¼š

1. ç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼Œå¯ä»¥è®¿é—® `https://media.xiph.org`
2. Git Bash æˆ– WSL ç¯å¢ƒ
3. æˆ–è€…æœ‰ RNNoise é¢„ç¼–è¯‘ç‰ˆæœ¬çš„é“¾æ¥

**æ–‡ä»¶è¦æ±‚**:
- æ–‡ä»¶: `rnnoise_data-0a8755f8e2d834eff6a54714ecc7d75f9932e845df35f8b59bc52a7cfe6e8b37.tar.gz`
- å¤§å°: çº¦ 200-300 KB
- ä½ç½®: æ”¾åˆ° `deps/rnnoise/` ç›®å½•
- è§£å‹ååº”ç”Ÿæˆ: `src/rnnoise_data.h` å’Œ `src/rnnoise_data.c`

---

## ğŸ“Š æ—¶é—´çº¿

```
âœ… 10æœˆ15æ—¥ä¸Šåˆ - RNNoise å…‹éš†æˆåŠŸ
âœ… 10æœˆ15æ—¥ä¸Šåˆ - C++ å®ç°å®Œæˆ
âœ… 10æœˆ15æ—¥ä¸Šåˆ - binding.gyp é…ç½®
âŒ 10æœˆ15æ—¥ä¸Šåˆ - æ¨¡å‹ä¸‹è½½å¤±è´¥ï¼ˆé˜»å¡ï¼‰
â³ 10æœˆ15æ—¥ä¸‹åˆ - ç­‰å¾…è§£å†³æ–¹æ¡ˆ...
ğŸ“… 10æœˆ15æ—¥æ™šä¸Š - é¢„è®¡å®Œæˆç¼–è¯‘ï¼ˆæ¨¡å‹è§£å†³åï¼‰
ğŸ“… 10æœˆ16-17æ—¥ - JavaScript API é›†æˆ
ğŸ“… 10æœˆ18-19æ—¥ - æµ‹è¯•å¼€å‘
ğŸ“… 10æœˆ20-21æ—¥ - æ–‡æ¡£å’Œä¼˜åŒ–
ğŸ“… 10æœˆ22æ—¥ - ç¬¬ä¸€å‘¨å®Œæˆ
```

---

**æ›´æ–°äºº**: GitHub Copilot  
**ä¸‹æ¬¡æ›´æ–°**: æ¨¡å‹é—®é¢˜è§£å†³å
