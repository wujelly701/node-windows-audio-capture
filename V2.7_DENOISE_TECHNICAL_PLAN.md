# v2.7.0 éŸ³é¢‘é™å™ªæŠ€æœ¯æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025å¹´10æœˆ15æ—¥  
**ä¼˜å…ˆçº§**: P0 - æœ€é«˜ä¼˜å…ˆçº§  
**çŠ¶æ€**: è§„åˆ’ä¸­

---

## ğŸ¯ ç›®æ ‡

ä¸º node-windows-audio-capture é›†æˆ **RNNoise æ·±åº¦å­¦ä¹ é™å™ª**ï¼Œæ˜¾è‘—æå‡è¯­éŸ³æ¸…æ™°åº¦ï¼Œä¼˜åŒ– ASR åœºæ™¯è¡¨ç°ã€‚

### æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹å¼ |
|------|--------|---------|
| å™ªéŸ³æŠ‘åˆ¶ | 15-20 dB | SNR å¯¹æ¯”æµ‹è¯• |
| ASR å‡†ç¡®ç‡æå‡ | 10-30% | ç™¾åº¦/é˜¿é‡Œäº‘/Whisper å¯¹æ¯” |
| å¤„ç†å»¶è¿Ÿ | < 10ms | æ€§èƒ½æµ‹è¯• |
| CPU å¼€é”€å¢åŠ  | < 5% | é•¿æ—¶é—´ç›‘æ§ |
| å†…å­˜å¢åŠ  | < 10 MB | ç¨³å®šæ€§æµ‹è¯• |

---

## ğŸ“Š æŠ€æœ¯èƒŒæ™¯

### RNNoise ç®€ä»‹

- **å¼€å‘è€…**: Mozilla/Xiph.Org
- **ç®—æ³•**: æ·±åº¦å­¦ä¹ ï¼ˆRNN + å…¨è¿æ¥å±‚ï¼‰
- **è®­ç»ƒæ•°æ®**: å¤§è§„æ¨¡è¯­éŸ³å’Œå™ªéŸ³æ•°æ®é›†
- **ä¼˜åŠ¿**: 
  - ä¼˜ç§€çš„é™å™ªæ•ˆæœï¼ˆ15-25 dBï¼‰
  - ä½ CPU å ç”¨ï¼ˆ< 10% å•æ ¸ï¼‰
  - å®æ—¶å¤„ç†èƒ½åŠ›
  - å¼€æº BSD è®¸å¯è¯

### ç®—æ³•ç‰¹ç‚¹

```
è¾“å…¥: 48kHz PCM éŸ³é¢‘ï¼ˆ480 samples/å¸§ï¼Œ10msï¼‰
å¤„ç†: RNN + Pitch Filter + é¢‘åŸŸæ»¤æ³¢
è¾“å‡º: é™å™ªåçš„ PCM éŸ³é¢‘
```

**å¤„ç†æµç¨‹**ï¼š
1. å°†éŸ³é¢‘åˆ†å¸§ï¼ˆ10msï¼‰
2. FFT è½¬æ¢åˆ°é¢‘åŸŸ
3. RNN é¢„æµ‹å™ªéŸ³æ¦‚ç‡
4. é¢‘åŸŸæ»¤æ³¢
5. IFFT è½¬æ¢å›æ—¶åŸŸ

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æµç¨‹

```
WASAPI æ•è·
    â†“
Zero-Copy Buffer (Float32, 48kHz, Stereo)
    â†“
[å¯é€‰] å£°é“è½¬æ¢ (Stereo â†’ Mono)
    â†“
[å¯é€‰] æ ¼å¼è½¬æ¢ (Float32 â†’ Int16)
    â†“
RNNoise é™å™ªå¤„ç† (480 samples/å¸§)
    â†“
è¾“å‡ºåˆ° JavaScript (Buffer)
    â†“
ASR API / ç”¨æˆ·ä»£ç 
```

### é›†æˆæ–¹å¼

**é€‰é¡¹ 1: é™æ€åº“é“¾æ¥ï¼ˆæ¨èï¼‰**

```cpp
// ç¼–è¯‘ RNNoise ä¸ºé™æ€åº“
deps/rnnoise/
  â”œâ”€ include/rnnoise.h
  â””â”€ lib/librnnoise.a

// åœ¨ binding.gyp ä¸­é“¾æ¥
{
  "libraries": ["../deps/rnnoise/lib/librnnoise.a"],
  "include_dirs": ["../deps/rnnoise/include"]
}
```

**é€‰é¡¹ 2: æºç é›†æˆ**

```
ç›´æ¥å°† RNNoise æºç æ·»åŠ åˆ°é¡¹ç›®ä¸­ç¼–è¯‘
ä¼˜ç‚¹: ç®€å•ï¼Œæ— éœ€é¢„ç¼–è¯‘
ç¼ºç‚¹: å¢åŠ ç¼–è¯‘æ—¶é—´
```

---

## ğŸ’» API è®¾è®¡

### JavaScript API

```typescript
interface AudioCaptureOptions {
  // ... ç°æœ‰é€‰é¡¹
  
  effects?: {
    // é™å™ªé…ç½®
    denoise?: boolean | DenoiseConfig;
  };
}

interface DenoiseConfig {
  enabled: boolean;        // å¯ç”¨é™å™ªï¼Œé»˜è®¤ false
  frameSize?: number;      // å¸§å¤§å°ï¼ˆsamplesï¼‰ï¼Œé»˜è®¤ 480
  modelPath?: string;      // è‡ªå®šä¹‰æ¨¡å‹è·¯å¾„ï¼ˆæœªæ¥æ”¯æŒï¼‰
}
```

### ä½¿ç”¨ç¤ºä¾‹

#### åŸºç¡€ç”¨æ³•

```javascript
const { AudioCapture } = require('node-windows-audio-capture');

// ç®€å•å¯ç”¨
const capture = new AudioCapture({
  processId: 0,
  useExternalBuffer: true,  // æ¨èä½¿ç”¨ zero-copy
  effects: {
    denoise: true  // ä¸€è¡Œå¯ç”¨é™å™ªï¼
  }
});

capture.on('data', (event) => {
  // event.buffer å·²ç»è¿‡é™å™ªå¤„ç†
  // ç›´æ¥å‘é€åˆ° ASR API
  console.log('é™å™ªåçš„éŸ³é¢‘:', event.buffer.length);
});

await capture.start();
```

#### é«˜çº§é…ç½®

```javascript
const capture = new AudioCapture({
  processId: 0,
  useExternalBuffer: true,
  effects: {
    denoise: {
      enabled: true,
      frameSize: 480  // 10ms @ 48kHz
    }
  }
});
```

#### ä¸ ASR é›†æˆ

```javascript
const AudioProcessingPipeline = require('node-windows-audio-capture/lib/audio-processing-pipeline');

// ç»„åˆé™å™ª + æ ¼å¼è½¬æ¢
const capture = new AudioCapture({
  processId: 0,
  useExternalBuffer: true,
  effects: {
    denoise: true  // é™å™ª
  }
});

// ASR æ ¼å¼è½¬æ¢ï¼ˆ16kHz, Mono, Int16ï¼‰
const pipeline = new AudioProcessingPipeline('china-asr');

capture.on('data', (event) => {
  // 1. é™å™ªå·²å®Œæˆ
  // 2. æ ¼å¼è½¬æ¢
  const asrReady = pipeline.process(event.buffer);
  
  // 3. å‘é€åˆ° ASR
  // await sendToASR(asrReady);
});
```

---

## ğŸ”§ C++ å®ç°

### æ ¸å¿ƒç±»è®¾è®¡

```cpp
// src/napi/audio_effects.h

#pragma once
#include <rnnoise.h>
#include <vector>
#include <memory>

namespace AudioCapture {

class DenoiseProcessor {
public:
    DenoiseProcessor(int frame_size = 480);
    ~DenoiseProcessor();
    
    // å¤„ç†å•å¸§éŸ³é¢‘ï¼ˆFloat32 æˆ– Int16ï¼‰
    void ProcessFrame(float* frame, int size);
    void ProcessFrame(int16_t* frame, int size);
    
    // æ‰¹é‡å¤„ç†
    void ProcessBuffer(float* buffer, int size);
    void ProcessBuffer(int16_t* buffer, int size);
    
    // è·å–ç»Ÿè®¡ä¿¡æ¯
    float GetLastVoiceProbability() const;
    int GetProcessedFrames() const;
    
private:
    DenoiseState* state_;
    int frame_size_;
    int processed_frames_;
    float last_vad_prob_;
    
    std::vector<float> temp_buffer_;  // ä¸´æ—¶ç¼“å†²åŒº
};

} // namespace AudioCapture
```

### å®ç°ç»†èŠ‚

```cpp
// src/napi/audio_effects.cpp

#include "audio_effects.h"
#include <cstring>
#include <stdexcept>

namespace AudioCapture {

DenoiseProcessor::DenoiseProcessor(int frame_size)
    : frame_size_(frame_size), processed_frames_(0), last_vad_prob_(0.0f) {
    
    if (frame_size != 480) {
        throw std::invalid_argument("RNNoise only supports 480 samples/frame");
    }
    
    // åˆå§‹åŒ– RNNoise çŠ¶æ€
    state_ = rnnoise_create(nullptr);
    if (!state_) {
        throw std::runtime_error("Failed to create RNNoise state");
    }
    
    temp_buffer_.resize(frame_size);
}

DenoiseProcessor::~DenoiseProcessor() {
    if (state_) {
        rnnoise_destroy(state_);
        state_ = nullptr;
    }
}

void DenoiseProcessor::ProcessFrame(float* frame, int size) {
    if (size != frame_size_) {
        throw std::invalid_argument("Frame size mismatch");
    }
    
    // RNNoise æœŸæœ› Float32 è¾“å…¥ï¼ŒèŒƒå›´ [-1, 1]
    last_vad_prob_ = rnnoise_process_frame(state_, frame, frame);
    processed_frames_++;
}

void DenoiseProcessor::ProcessFrame(int16_t* frame, int size) {
    // Int16 â†’ Float32
    for (int i = 0; i < size; i++) {
        temp_buffer_[i] = frame[i] / 32768.0f;
    }
    
    ProcessFrame(temp_buffer_.data(), size);
    
    // Float32 â†’ Int16
    for (int i = 0; i < size; i++) {
        float sample = temp_buffer_[i] * 32768.0f;
        frame[i] = static_cast<int16_t>(
            std::max(-32768.0f, std::min(32767.0f, sample))
        );
    }
}

void DenoiseProcessor::ProcessBuffer(float* buffer, int size) {
    int num_frames = size / frame_size_;
    
    for (int i = 0; i < num_frames; i++) {
        ProcessFrame(buffer + i * frame_size_, frame_size_);
    }
    
    // å¤„ç†å‰©ä½™æ ·æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
    int remaining = size % frame_size_;
    if (remaining > 0) {
        // é›¶å¡«å……åˆ°å®Œæ•´å¸§
        std::vector<float> padded_frame(frame_size_, 0.0f);
        std::memcpy(padded_frame.data(), buffer + num_frames * frame_size_, 
                    remaining * sizeof(float));
        ProcessFrame(padded_frame.data(), frame_size_);
        std::memcpy(buffer + num_frames * frame_size_, padded_frame.data(), 
                    remaining * sizeof(float));
    }
}

float DenoiseProcessor::GetLastVoiceProbability() const {
    return last_vad_prob_;
}

int DenoiseProcessor::GetProcessedFrames() const {
    return processed_frames_;
}

} // namespace AudioCapture
```

### é›†æˆåˆ° AudioProcessor

```cpp
// src/napi/audio_processor.h

class AudioProcessor : public Napi::ObjectWrap<AudioProcessor> {
public:
    // ... ç°æœ‰æ–¹æ³•
    
    // v2.7: é™å™ªé…ç½®
    Napi::Value SetDenoiseEnabled(const Napi::CallbackInfo& info);
    Napi::Value GetDenoiseEnabled(const Napi::CallbackInfo& info);
    Napi::Value GetDenoiseStats(const Napi::CallbackInfo& info);
    
private:
    // ... ç°æœ‰æˆå‘˜
    
    // v2.7: é™å™ªå¤„ç†å™¨
    std::unique_ptr<DenoiseProcessor> denoise_processor_;
    bool denoise_enabled_;
    
    // éŸ³é¢‘æ•°æ®å¤„ç†å›è°ƒï¼ˆæ·»åŠ é™å™ªï¼‰
    void OnAudioData(const std::vector<uint8_t>& data);
};
```

```cpp
// src/napi/audio_processor.cpp

void AudioProcessor::OnAudioData(const std::vector<uint8_t>& data) {
    // 1. Zero-Copy Bufferï¼ˆå¦‚æœå¯ç”¨ï¼‰
    std::shared_ptr<ExternalBuffer> buffer;
    if (useExternalBuffer_) {
        buffer = ExternalBufferFactory::Instance().Create();
        if (buffer && buffer->size() >= data.size()) {
            std::memcpy(buffer->data(), data.data(), data.size());
        }
    }
    
    // 2. é™å™ªå¤„ç†ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    if (denoise_enabled_ && denoise_processor_) {
        // å‡è®¾æ•°æ®æ ¼å¼ä¸º Float32
        float* audio_data = reinterpret_cast<float*>(
            buffer ? buffer->data() : const_cast<uint8_t*>(data.data())
        );
        int num_samples = data.size() / sizeof(float);
        
        denoise_processor_->ProcessBuffer(audio_data, num_samples);
    }
    
    // 3. ä¼ é€’åˆ° JavaScript
    if (useExternalBuffer_ && buffer) {
        // Zero-Copy è·¯å¾„
        auto buffer_value = ExternalBuffer::ToBufferFromShared(env_, buffer, data.size());
        // emit åˆ° JavaScript
    } else {
        // ä¼ ç»Ÿè·¯å¾„
        auto buffer_value = Napi::Buffer<uint8_t>::Copy(env_, data.data(), data.size());
        // emit åˆ° JavaScript
    }
}
```

---

## ğŸ“¦ ç¼–è¯‘é…ç½®

### binding.gyp

```python
{
  "targets": [
    {
      "target_name": "audio_addon",
      "sources": [
        "src/napi/addon.cpp",
        "src/napi/audio_processor.cpp",
        "src/napi/audio_effects.cpp",  # æ–°å¢
        # ... å…¶ä»–æºæ–‡ä»¶
      ],
      "include_dirs": [
        "<!@(node -p \"require('node-addon-api').include\")",
        "src",
        "deps/rnnoise/include"  # RNNoise å¤´æ–‡ä»¶
      ],
      "dependencies": [
        "<!(node -p \"require('node-addon-api').gyp\")"
      ],
      "libraries": [
        "../deps/rnnoise/lib/librnnoise.a"  # RNNoise é™æ€åº“
      ],
      "cflags!": [ "-fno-exceptions" ],
      "cflags_cc!": [ "-fno-exceptions" ],
      "defines": [ "NAPI_DISABLE_CPP_EXCEPTIONS" ],
      "conditions": [
        ["OS=='win'", {
          "msvs_settings": {
            "VCCLCompilerTool": {
              "ExceptionHandling": 1
            }
          }
        }]
      ]
    }
  ]
}
```

### RNNoise ç¼–è¯‘è„šæœ¬

```bash
# scripts/build-rnnoise.sh (Linux/macOS)

#!/bin/bash
set -e

echo "Building RNNoise..."

# å…‹éš† RNNoise
if [ ! -d "deps/rnnoise" ]; then
    git clone https://gitlab.xiph.org/xiph/rnnoise.git deps/rnnoise
fi

cd deps/rnnoise

# é…ç½®å’Œç¼–è¯‘
./autogen.sh
./configure --disable-shared --enable-static
make

# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p lib include
cp .libs/librnnoise.a lib/
cp include/rnnoise.h include/

echo "RNNoise built successfully!"
```

```powershell
# scripts/build-rnnoise.ps1 (Windows)

Write-Host "Building RNNoise for Windows..."

# æ£€æŸ¥ Visual Studio
if (-not (Test-Path "C:\Program Files\Microsoft Visual Studio")) {
    Write-Error "Visual Studio not found!"
    exit 1
}

# å…‹éš† RNNoise
if (-not (Test-Path "deps\rnnoise")) {
    git clone https://gitlab.xiph.org/xiph/rnnoise.git deps\rnnoise
}

cd deps\rnnoise

# ä½¿ç”¨ CMake ç¼–è¯‘ï¼ˆéœ€è¦åˆ›å»º CMakeLists.txtï¼‰
mkdir build -Force
cd build

cmake .. -G "Visual Studio 17 2022" -A x64 `
    -DBUILD_SHARED_LIBS=OFF

cmake --build . --config Release

# å¤åˆ¶æ–‡ä»¶
Copy-Item Release\rnnoise.lib ..\lib\ -Force
Copy-Item ..\include\rnnoise.h ..\include\ -Force

Write-Host "RNNoise built successfully!"
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```javascript
// test/denoise.test.js

describe('Audio Denoise', () => {
  it('should enable denoise successfully', () => {
    const capture = new AudioCapture({
      processId: 0,
      effects: { denoise: true }
    });
    
    expect(capture.getDenoiseEnabled()).toBe(true);
  });
  
  it('should process audio with denoise', async () => {
    const capture = new AudioCapture({
      processId: 0,
      useExternalBuffer: true,
      effects: { denoise: true }
    });
    
    let dataReceived = false;
    
    capture.on('data', (event) => {
      dataReceived = true;
      expect(event.buffer).toBeDefined();
      expect(event.buffer.length).toBeGreaterThan(0);
    });
    
    await capture.start();
    await new Promise(resolve => setTimeout(resolve, 1000));
    capture.stop();
    
    expect(dataReceived).toBe(true);
  });
  
  it('should provide denoise stats', async () => {
    const capture = new AudioCapture({
      processId: 0,
      effects: { denoise: true }
    });
    
    await capture.start();
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    const stats = capture.getDenoiseStats();
    expect(stats.processedFrames).toBeGreaterThan(0);
    expect(stats.voiceProbability).toBeGreaterThanOrEqual(0);
    expect(stats.voiceProbability).toBeLessThanOrEqual(1);
    
    capture.stop();
  });
});
```

### éŸ³é¢‘è´¨é‡æµ‹è¯•

```javascript
// test/audio-quality.test.js

const fs = require('fs');
const { AudioCapture } = require('..');

describe('Audio Quality - Denoise', () => {
  it('should reduce background noise', async () => {
    // å½•åˆ¶ 5 ç§’éŸ³é¢‘ï¼ˆæ— é™å™ªï¼‰
    const capture1 = new AudioCapture({ processId: 0 });
    const chunks1 = [];
    
    capture1.on('data', (e) => chunks1.push(e.buffer));
    await capture1.start();
    await new Promise(resolve => setTimeout(resolve, 5000));
    capture1.stop();
    
    const noDenoiseAudio = Buffer.concat(chunks1);
    fs.writeFileSync('test/output/no-denoise.raw', noDenoiseAudio);
    
    // å½•åˆ¶ 5 ç§’éŸ³é¢‘ï¼ˆå¯ç”¨é™å™ªï¼‰
    const capture2 = new AudioCapture({
      processId: 0,
      effects: { denoise: true }
    });
    const chunks2 = [];
    
    capture2.on('data', (e) => chunks2.push(e.buffer));
    await capture2.start();
    await new Promise(resolve => setTimeout(resolve, 5000));
    capture2.stop();
    
    const denoiseAudio = Buffer.concat(chunks2);
    fs.writeFileSync('test/output/denoise.raw', denoiseAudio);
    
    // äººå·¥å¯¹æ¯”ï¼ˆéœ€è¦è½¬æ¢ä¸º WAV å¹¶æ’­æ”¾ï¼‰
    console.log('âœ… Audio files saved for manual comparison');
    console.log('   no-denoise.raw: åŸå§‹éŸ³é¢‘');
    console.log('   denoise.raw: é™å™ªåéŸ³é¢‘');
  });
});
```

### ASR å‡†ç¡®ç‡æµ‹è¯•

```javascript
// test/asr-accuracy.test.js

const { AudioCapture } = require('..');
const AudioProcessingPipeline = require('../lib/audio-processing-pipeline');

describe('ASR Accuracy - Denoise Impact', () => {
  it('should improve ASR accuracy with denoise', async function() {
    this.timeout(60000);  // 1 åˆ†é’Ÿæµ‹è¯•
    
    // åœºæ™¯ 1: æ— é™å™ª
    const capture1 = new AudioCapture({ processId: 0 });
    const pipeline1 = new AudioProcessingPipeline('china-asr');
    const chunks1 = [];
    
    capture1.on('data', (e) => {
      const converted = pipeline1.process(e.buffer);
      chunks1.push(converted);
    });
    
    await capture1.start();
    console.log('ğŸ¤ å½•åˆ¶ 10 ç§’éŸ³é¢‘ï¼ˆæ— é™å™ªï¼‰...');
    await new Promise(resolve => setTimeout(resolve, 10000));
    capture1.stop();
    
    const audio1 = Buffer.concat(chunks1);
    
    // å‘é€åˆ° ASR APIï¼ˆç¤ºä¾‹ï¼‰
    // const result1 = await sendToASR(audio1);
    
    // åœºæ™¯ 2: å¯ç”¨é™å™ª
    const capture2 = new AudioCapture({
      processId: 0,
      effects: { denoise: true }
    });
    const pipeline2 = new AudioProcessingPipeline('china-asr');
    const chunks2 = [];
    
    capture2.on('data', (e) => {
      const converted = pipeline2.process(e.buffer);
      chunks2.push(converted);
    });
    
    await capture2.start();
    console.log('ğŸ¤ å½•åˆ¶ 10 ç§’éŸ³é¢‘ï¼ˆå¯ç”¨é™å™ªï¼‰...');
    await new Promise(resolve => setTimeout(resolve, 10000));
    capture2.stop();
    
    const audio2 = Buffer.concat(chunks2);
    
    // å‘é€åˆ° ASR APIï¼ˆç¤ºä¾‹ï¼‰
    // const result2 = await sendToASR(audio2);
    
    // å¯¹æ¯”å‡†ç¡®ç‡
    // expect(result2.accuracy).toBeGreaterThan(result1.accuracy);
    
    console.log('âœ… ASR å‡†ç¡®ç‡å¯¹æ¯”æµ‹è¯•å®Œæˆ');
    console.log('   ï¼ˆéœ€è¦å®é™… ASR API æ‰èƒ½éªŒè¯ï¼‰');
  });
});
```

### æ€§èƒ½æµ‹è¯•

```javascript
// test/denoise-performance.test.js

describe('Denoise Performance', () => {
  it('should have low CPU overhead', async () => {
    const capture = new AudioCapture({
      processId: 0,
      useExternalBuffer: true,
      effects: { denoise: true }
    });
    
    const startCPU = process.cpuUsage();
    const startTime = Date.now();
    
    let frameCount = 0;
    capture.on('data', () => frameCount++);
    
    await capture.start();
    await new Promise(resolve => setTimeout(resolve, 30000));  // 30 ç§’
    capture.stop();
    
    const endCPU = process.cpuUsage(startCPU);
    const duration = (Date.now() - startTime) / 1000;
    
    const cpuPercent = ((endCPU.user + endCPU.system) / 1000000 / duration) * 100;
    
    console.log(`CPU Usage: ${cpuPercent.toFixed(2)}%`);
    console.log(`Frames Processed: ${frameCount}`);
    console.log(`FPS: ${(frameCount / duration).toFixed(1)}`);
    
    expect(cpuPercent).toBeLessThan(15);  // < 15% CPU
  });
  
  it('should have low processing latency', async () => {
    const capture = new AudioCapture({
      processId: 0,
      effects: { denoise: true }
    });
    
    const latencies = [];
    
    capture.on('data', (event) => {
      const now = Date.now();
      const latency = now - event.timestamp;
      latencies.push(latency);
    });
    
    await capture.start();
    await new Promise(resolve => setTimeout(resolve, 10000));
    capture.stop();
    
    const avgLatency = latencies.reduce((a, b) => a + b, 0) / latencies.length;
    const maxLatency = Math.max(...latencies);
    
    console.log(`Average Latency: ${avgLatency.toFixed(2)} ms`);
    console.log(`Max Latency: ${maxLatency} ms`);
    
    expect(avgLatency).toBeLessThan(20);  // < 20ms å¹³å‡å»¶è¿Ÿ
    expect(maxLatency).toBeLessThan(50);  // < 50ms æœ€å¤§å»¶è¿Ÿ
  });
});
```

---

## ğŸ“‹ å¼€å‘è®¡åˆ’

### ç¬¬ 1 å‘¨ï¼šRNNoise é›†æˆ

**ä»»åŠ¡**ï¼š
- [ ] å…‹éš† RNNoise ä»“åº“åˆ° `deps/rnnoise`
- [ ] ç¼–å†™ç¼–è¯‘è„šæœ¬ï¼ˆWindows + Linuxï¼‰
- [ ] ç¼–è¯‘ RNNoise é™æ€åº“
- [ ] éªŒè¯åº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶æ­£ç¡®ç”Ÿæˆ
- [ ] æ›´æ–° `binding.gyp` é…ç½®
- [ ] æµ‹è¯•ç¼–è¯‘ addon

**äº¤ä»˜ç‰©**ï¼š
- `deps/rnnoise/lib/librnnoise.a` (æˆ– `.lib`)
- `deps/rnnoise/include/rnnoise.h`
- `scripts/build-rnnoise.sh` / `.ps1`
- ç¼–è¯‘æˆåŠŸçš„ addon

---

### ç¬¬ 2 å‘¨ï¼šC++ å®ç°å’Œç»‘å®š

**ä»»åŠ¡**ï¼š
- [ ] å®ç° `DenoiseProcessor` ç±»
- [ ] é›†æˆåˆ° `AudioProcessor::OnAudioData()`
- [ ] å®ç° JavaScript API ç»‘å®š
  - `setDenoiseEnabled(enabled)`
  - `getDenoiseEnabled()`
  - `getDenoiseStats()`
- [ ] æ·»åŠ é…ç½®é€‰é¡¹è§£æ
- [ ] å¤„ç†ä¸åŒéŸ³é¢‘æ ¼å¼ï¼ˆFloat32/Int16ï¼‰
- [ ] å•å…ƒæµ‹è¯•

**äº¤ä»˜ç‰©**ï¼š
- `src/napi/audio_effects.h` / `.cpp`
- æ›´æ–°çš„ `audio_processor.cpp`
- åŸºç¡€å•å…ƒæµ‹è¯•é€šè¿‡

---

### ç¬¬ 3 å‘¨ï¼šæµ‹è¯•ã€æ–‡æ¡£å’Œç¤ºä¾‹

**ä»»åŠ¡**ï¼š
- [ ] å®Œæ•´æµ‹è¯•å¥—ä»¶
  - åŠŸèƒ½æµ‹è¯•ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
  - éŸ³é¢‘è´¨é‡æµ‹è¯•ï¼ˆA/B å¯¹æ¯”ï¼‰
  - ASR å‡†ç¡®ç‡æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
  - æ€§èƒ½æµ‹è¯•ï¼ˆCPU/å»¶è¿Ÿï¼‰
- [ ] æ›´æ–° README.md
- [ ] æ›´æ–° API æ–‡æ¡£
- [ ] ç¼–å†™ä½¿ç”¨ç¤ºä¾‹
  - åŸºç¡€é™å™ªç¤ºä¾‹
  - ä¸ ASR é›†æˆç¤ºä¾‹
  - æ€§èƒ½è°ƒä¼˜ç¤ºä¾‹
- [ ] æ›´æ–° TypeScript ç±»å‹å®šä¹‰

**äº¤ä»˜ç‰©**ï¼š
- å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ˆ90%+ è¦†ç›–ç‡ï¼‰
- æ›´æ–°çš„æ–‡æ¡£
- `examples/denoise-example.js`
- æ›´æ–°çš„ `index.d.ts`

---

## ğŸ“ æ–‡æ¡£æ›´æ–°æ¸…å•

### README.md

- [ ] æ·»åŠ  v2.7 ç‰¹æ€§è¯´æ˜ï¼ˆé™å™ªï¼‰
- [ ] æ›´æ–°å¿«é€Ÿå¼€å§‹ç¤ºä¾‹
- [ ] æ·»åŠ é™å™ª API æ–‡æ¡£
- [ ] æ›´æ–°è·¯çº¿å›¾

### API æ–‡æ¡£

- [ ] æ–°å¢ `effects.denoise` é…ç½®è¯´æ˜
- [ ] æ–°å¢ `setDenoiseEnabled()` æ–¹æ³•
- [ ] æ–°å¢ `getDenoiseStats()` æ–¹æ³•
- [ ] æ·»åŠ éŸ³é¢‘è´¨é‡å¯¹æ¯”æ•°æ®

### ç¤ºä¾‹ä»£ç 

- [ ] `examples/denoise-basic.js` - åŸºç¡€é™å™ª
- [ ] `examples/denoise-asr-integration.js` - ASR é›†æˆ
- [ ] `examples/denoise-performance-test.js` - æ€§èƒ½æµ‹è¯•

### TypeScript å®šä¹‰

```typescript
// index.d.ts æ›´æ–°

interface AudioCaptureOptions {
  // ... ç°æœ‰é€‰é¡¹
  
  effects?: {
    denoise?: boolean | DenoiseConfig;
  };
}

interface DenoiseConfig {
  enabled: boolean;
  frameSize?: number;
}

interface DenoiseStats {
  processedFrames: number;
  voiceProbability: number;
}

class AudioCapture extends EventEmitter {
  // ... ç°æœ‰æ–¹æ³•
  
  setDenoiseEnabled(enabled: boolean): void;
  getDenoiseEnabled(): boolean;
  getDenoiseStats(): DenoiseStats;
}
```

---

## ğŸš€ å‘å¸ƒç­–ç•¥

### v2.7.0-alpha (2025å¹´11æœˆåº•)

**åŒ…å«**ï¼š
- âœ… è‡ªé€‚åº” Buffer Pool
- âœ… RNNoise é™å™ªï¼ˆåŸºç¡€åŠŸèƒ½ï¼‰
- âœ… åŸºç¡€æµ‹è¯•å¥—ä»¶

**ç›®æ ‡ç”¨æˆ·**ï¼šæ—©æœŸæµ‹è¯•è€…

---

### v2.7.0-beta (2025å¹´12æœˆåˆ)

**åŒ…å«**ï¼š
- âœ… Alpha æ‰€æœ‰ç‰¹æ€§
- âœ… å®Œæ•´æµ‹è¯•è¦†ç›–
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… å®Œæ•´æ–‡æ¡£

**ç›®æ ‡ç”¨æˆ·**ï¼šBeta æµ‹è¯•è€…

---

### v2.7.0 (2025å¹´12æœˆä¸­æ—¬)

**åŒ…å«**ï¼š
- âœ… Beta æ‰€æœ‰ç‰¹æ€§
- âœ… Bug ä¿®å¤
- âœ… å®Œæ•´ç¤ºä¾‹ä»£ç 
- âœ… ASR å‡†ç¡®ç‡éªŒè¯æ•°æ®

**ç›®æ ‡ç”¨æˆ·**ï¼šæ‰€æœ‰ç”¨æˆ·

---

## ğŸ“Š æˆåŠŸæ ‡å‡†

### åŠŸèƒ½æ ‡å‡†

- [x] RNNoise æˆåŠŸç¼–è¯‘å’Œé“¾æ¥
- [ ] é™å™ªåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] API ä½¿ç”¨ç®€å•ï¼ˆä¸€è¡Œå¯ç”¨ï¼‰
- [ ] å‘åå…¼å®¹ï¼ˆopt-in è®¾è®¡ï¼‰

### æ€§èƒ½æ ‡å‡†

- [ ] å™ªéŸ³æŠ‘åˆ¶ â‰¥ 15 dB
- [ ] å¤„ç†å»¶è¿Ÿ < 10ms
- [ ] CPU å¼€é”€ < 5%
- [ ] å†…å­˜å¢åŠ  < 10 MB

### è´¨é‡æ ‡å‡†

- [ ] ASR å‡†ç¡®ç‡æå‡ 10-30%
- [ ] éŸ³é¢‘æ— æ˜æ˜¾å¤±çœŸ
- [ ] é•¿æ—¶é—´è¿è¡Œç¨³å®šï¼ˆ1å°æ—¶+ï¼‰
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 90%

### ç”¨æˆ·ä½“éªŒæ ‡å‡†

- [ ] é…ç½®ç®€å•ï¼ˆé»˜è®¤å‚æ•°å³å¯ç”¨ï¼‰
- [ ] æ–‡æ¡£æ¸…æ™°å®Œæ•´
- [ ] ç¤ºä¾‹ä»£ç ä¸°å¯Œ
- [ ] é”™è¯¯å¤„ç†å‹å¥½

---

## ğŸ” é£é™©è¯„ä¼°

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| RNNoise ç¼–è¯‘å›°éš¾ | é«˜ | ä¸­ | æå‰éªŒè¯ï¼Œæä¾›è¯¦ç»†æ–‡æ¡£ |
| CPU å¼€é”€è¿‡é«˜ | ä¸­ | ä½ | æ€§èƒ½æµ‹è¯•ï¼Œopt-in è®¾è®¡ |
| éŸ³é¢‘è´¨é‡ä¸‹é™ | é«˜ | ä½ | A/B æµ‹è¯•ï¼Œå¯é…ç½®å¼ºåº¦ |
| Windows ç¼–è¯‘é—®é¢˜ | ä¸­ | ä¸­ | æä¾›é¢„ç¼–è¯‘åº“é€‰é¡¹ |
| å†…å­˜æ³„æ¼ | é«˜ | ä½ | Valgrind æµ‹è¯•ï¼Œä»£ç å®¡æŸ¥ |

---

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

### å¼€å‘è¿‡ç¨‹ä¸­

- å®šæœŸæ›´æ–°è¿›åº¦ï¼ˆæ¯å‘¨ï¼‰
- GitHub Issues è·Ÿè¸ªé—®é¢˜
- Discord/Slack æŠ€æœ¯è®¨è®º

### å‘å¸ƒå

- æ”¶é›†ç”¨æˆ·åé¦ˆ
- å¿«é€Ÿä¿®å¤å…³é”® bug
- æŒç»­ä¼˜åŒ–æ€§èƒ½

---

**æ–‡æ¡£ä½œè€…**: GitHub Copilot  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸  
**ä¸‹ä¸€æ­¥**: å¼€å§‹ç¬¬ 1 å‘¨å¼€å‘å·¥ä½œ
